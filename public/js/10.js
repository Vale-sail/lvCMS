webpackJsonp([10],{256:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={props:["power"],data:function(){return{loading1:!1,msg:"",end:!1,showDetail:!0,draftId:"",drafts:"",fileList:[],thumbnail:"",ue:"",list:[],article:{name:"",class:[],content:"",original:1,source:"",draft:0},class:"",classOptions:[],listChangeFlag:0,thumbnailChangeFlag:0,editId:""}},mounted:function(){this.ue||(this.ue=UE.getEditor("container",{initialFrameHeight:900,initialFrameWidth:"100%",autoHeight:!1,toolbars:[["source","preview","insertcode","fontfamily","fontsize","paragraph","customstyle","inserttable","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","deletecaption","inserttitle","mergecells","deletetable","edittd","edittable","fullscreen"],["undo","redo","bold","italic","underline","strikethrough","subscript","fontborder","superscript","formatmatch","blockquote","justifyleft","justifyright","justifycenter","justifyjustify","insertorderedlist","insertunorderedlist","forecolor","backcolor","background","simpleupload","insertimage","link","unlink"],["snapscreen","pasteplain","horizontal","removeformat","time","date","cleardoc","insertparagraphbeforetable","emotion","rowspacingtop","rowspacingbottom","imagenone","imageleft","imageright","attachment","imagecenter","lineheight"]]})),this.init(),this.$route.query.articleId&&(this.editId=this.$route.query.articleId)},destroyed:function(){this.ue.destroy(),this.ue=""},methods:{reset:function(){this.end=!1,this.draftId="",this.drafts="",this.fileList=[],this.thumbnail="",this.list=[],this.article={name:"",class:[],content:"",original:1,source:"",draft:0},this.class="",this.listChangeFlag=0,this.thumbnailChangeFlag=0,this.editId="",this.ue.setContent(""),this.init()},test:function(){},handleBefore:function(t){return!(t.size>10485760)||(this.$message.error("单个文件大于10MB，不允许上传"),!1)},thumbnailChange:function(){var t=$("input[name='thumbnail']").get(0),e=t.files[0].size;if(!/image\/\w+/.test(t.files[0].type))return void this.$message.error("只能上传图片");if(e>5242880)return void this.$message.error("图片最大为5M");var i=new FileReader;i.readAsDataURL(t.files[0]);var a=this;i.onload=function(t){a.thumbnail=t.target.result},this.thumbnailChangeFlag=1},init:function(){this.loading1=!0,this.$http.post("addArticle",{}).then(function(t){t.body.result?(this.$message.success("获取信息成功"),this.classOptions=t.body.classOptions,this.drafts=t.body.drafts):this.$message.error(t.body.msg),this.loading1=!1}).catch(function(t){if(422==t.status){for(var e in t.body){var i=t.body[e];this.$message.error(i[0])}}else this.$message.error("错误：状态码"+t.status);this.loading1=!1})},handleSuccess:function(t,e,i){if(t.result)t.result?(this.list.push({name:e.name,url:t.file}),this.listChangeFlag=1):this.$message.error("本地 ERRO1");else{var a=i.length;i.length--,delete i[a],this.$message.error(t.msg)}},handleRemove:function(t,e){for(var i in this.list)if(this.list[i].name==t.name){this.list.splice(i,1),this.listChangeFlag=1;break}},submit:function(t){if(this.article.name.trim().length<1)return void this.$message.error("请填写文章标题");this.article.draft=t?0:1,this.class=this.article.class[this.article.class.length-1],this.article.content=this.ue.getContent();var e="/admin/addArticle/public";this.editId&&(e="/admin/addArticle/edit"),this.$message.info("正在提交信息"),this.loading1=!0,this.$http.post(e,{editId:this.editId,article:this.article,class:this.class,thumbnail:1==this.thumbnailChangeFlag?this.thumbnail:"",list:1==this.listChangeFlag?this.list:""}).then(function(t){t.body.result?(this.$message.success("发布文章成功"),this.end=!0,this.msg=t.body.msg):this.$message.success("发布文章失败:"+t.body.msg),this.loading1=!1}).catch(function(t){if(422==t.status){for(var e in t.body){var i=t.body[e];this.$message.error(i[0])}}else this.$message.error("错误：状态码"+t.status);this.loading1=!1})},getEditInfo:function(){this.loading1=!0,this.$http.get("/admin/addArticle/edit",{params:{articleId:this.editId}}).then(function(t){if(t.body.result){this.$message.success("获取信息成功");var e=t.body.editArticleInfo;this.article.name=e.title,this.article.class=e.classId,this.article.original=e.original,this.article.source=e.source,this.article.draft=2==e.state?1:0,this.thumbnail=e.thumbnail,this.fileList=t.body.list,this.list=t.body.list,this.ue.ready(function(){this.setContent(t.body.editArticleInfo.content)})}else this.$message.error("失败:"+t.body.msg);this.loading1=!1}).catch(function(t){if(422==t.status){for(var e in t.body){var i=t.body[e];this.$message.error(i[0])}}else this.$message.error("错误：状态码"+t.status);this.loading1=!1})}},watch:{$route:function(){this.$route.query.articleId&&(this.editId=this.$route.query.articleId)},draftId:function(){if(this.draftId){var t=location.href,e=t.indexOf("?");location.href=e>0?t.substring(0,e)+"?articleId="+this.draftId:t+"?articleId="+this.draftId}},editId:function(){this.editId&&this.getEditInfo()}}}},267:function(t,e,i){e=t.exports=i(7)(),e.push([t.i,'.textInfo [data-v-05017ba2]:hover{cursor:pointer}.avatar-uploader[data-v-05017ba2]{border:1px dashed #aaa;border-radius:6px;cursor:pointer;position:relative;overflow:hidden;float:right}.avatar-uploader .el-upload[data-v-05017ba2]:hover{border-color:#20a0ff}.avatar-uploader-icon[data-v-05017ba2]{font-size:28px;color:#8c939d;width:200px;height:200px;line-height:200px;text-align:center}.avatar[data-v-05017ba2]{width:200px;height:200px;display:block}.thumb[data-v-05017ba2]{float:right;margin:0 10px 10px;border-radius:10px;width:40%;height:50%}.left[data-v-05017ba2]{display:inline-block;width:70%}.rightPic[data-v-05017ba2]{width:40%;float:right}.text[data-v-05017ba2]{font-size:14px}.item[data-v-05017ba2]{padding:18px 0}.clearfix[data-v-05017ba2]:after,.clearfix[data-v-05017ba2]:before{display:table;content:""}.clearfix[data-v-05017ba2]:after{clear:both}.box-card[data-v-05017ba2]{width:100%}',""])},523:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading1,expression:"loading1"}],staticStyle:{padding:"20px"},attrs:{"element-loading-text":"加载中"}},[i("el-popover",{ref:"selectDraft",attrs:{placement:"left",width:"400",trigger:"click"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:t.draftId,callback:function(e){t.draftId=e},expression:"draftId"}},t._l(t.drafts,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}},[i("span",{staticStyle:{float:"left"}},[t._v(t._s(e.label))]),t._v(" "),i("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.time))])])}))],1),t._v(" "),i("el-card",{staticClass:"box-card"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.end,expression:"!end"}],staticClass:"clearfix",slot:"header"},[i("span",{staticStyle:{"line-height":"36px","font-size":"25px","font-weight":"500"}},[i("a",{staticClass:"textInfo",attrs:{title:"收起/展开"}},[i("i",{staticClass:"el-icon-caret-top",on:{click:function(e){t.showDetail=!t.showDetail}}})]),t._v(" 写文章")]),t._v(" "),i("div",{staticStyle:{float:"right"}},[t.power.indexOf("editArticle")>0?i("el-button",{directives:[{name:"popover",rawName:"v-popover:selectDraft",arg:"selectDraft"}],attrs:{type:"primary"}},[t._v("从草稿加载")]):t._e(),t._v(" "),t.power.indexOf("publicArticle")>0?i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submit(!1)}}},[t._v("保存为草稿")]):t._e(),t._v(" "),t.power.indexOf("publicArticle")>0?i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submit(!0)}}},[t._v("发布")]):t._e()],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.end,expression:"!end"}],staticClass:"text item"},[i("el-row",{directives:[{name:"show",rawName:"v-show",value:t.showDetail,expression:"showDetail"}],attrs:{type:"flex"}},[i("el-col",{attrs:{span:10}},[i("div",{staticClass:" "},[i("el-form",{attrs:{model:t.article,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"文章标题"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:t.article.name,callback:function(e){t.article.name=e},expression:"article.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"文章类别"}},[i("el-cascader",{staticStyle:{width:"100%"},attrs:{"expand-trigger":"hover",options:t.classOptions,filterable:"","change-on-select":""},model:{value:t.article.class,callback:function(e){t.article.class=e},expression:"article.class"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"原创"}},[i("el-row",[i("el-col",{attrs:{span:4}},[i("el-switch",{attrs:{"on-color":"#13ce66","off-color":"#ff4949","on-text":"是","off-text":"否","on-value":1,"off-value":0},model:{value:t.article.original,callback:function(e){t.article.original=e},expression:"article.original"}})],1),t._v(" "),t.article.original?t._e():i("el-col",{attrs:{span:20}},[i("el-input",{attrs:{placeholder:"文章来源"},model:{value:t.article.source,callback:function(e){t.article.source=e},expression:"article.source"}})],1)],1)],1),t._v(" "),t.power.indexOf("postAttachMent")>0?i("el-form-item",{attrs:{label:"附件"}},[i("el-upload",{staticClass:"upload-demo",attrs:{action:"/admin/addArticle/attach","with-credentials":!0,"before-upload":t.handleBefore,"on-success":t.handleSuccess,"on-remove":t.handleRemove,"file-list":t.fileList,"show-file-list":""}},[i("el-button",{attrs:{size:"small",type:"primary"}},[t._v("点击上传")]),t._v(" "),i("div",{staticClass:"el-upload__tip",slot:"tip"},[t._v("单个文件不能超过10MB")])],1)],1):t._e()],1)],1)]),t._v(" "),i("el-col",{attrs:{span:10,offset:4}},[i("div",{staticClass:"avatar-uploader"},[i("el-upload",{attrs:{action:"/qq","show-file-list":!1,"auto-upload":!1,name:"thumbnail","with-credentials":!0,accept:"image/jpg,image/png","on-change":t.thumbnailChange}},[t.thumbnail?i("img",{staticClass:"avatar",attrs:{src:t.thumbnail,alt:"缩略图"}}):i("i",{staticClass:"  el-icon-plus avatar-uploader-icon"},[t._v("缩略图")])])],1)])],1),t._v(" "),i("script",{attrs:{id:"container",name:"content",type:"text/plain"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.end,expression:"end"}],staticStyle:{height:"400px"}},[i("div",{staticStyle:{"margin-top":"100px","text-align":"center"}},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("img",{attrs:{src:"http://img.baidu.com/hi/jx2/j_0072.gif"}})]),t._v(" "),i("span",{staticStyle:{"font-size":"40px","font-weight":"300"}},[t._v(t._s(t.msg))]),t._v(" "),i("div",{staticStyle:{"margin-top":"50px"}},[t.power.indexOf("AddArticlePage")>0?i("el-button",{attrs:{size:"large",type:"info"},on:{click:function(e){t.reset()}}},[t._v("继续添加")]):t._e(),t._v(" "),t.power.indexOf("editArticle")>0?i("el-button",{attrs:{size:"large",type:"success"},on:{click:function(e){t.end=!1}}},[t._v("重新编辑")]):t._e(),t._v(" "),i("el-button",{attrs:{size:"large",type:"primary"}},[t._v("查看文章")])],1)])])])],1)},staticRenderFns:[]}},535:function(t,e,i){var a=i(267);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);i(28)("4855ec18",a,!0)},94:function(t,e,i){i(535);var a=i(27)(i(256),i(523),"data-v-05017ba2",null);t.exports=a.exports}});