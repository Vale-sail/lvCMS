webpackJsonp([1],{103:function(e,t,s){s(537);var o=s(27)(s(265),s(525),null,null);e.exports=o.exports},265:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={props:["power"],mounted:function(){this.init()},data:function(){return{loading1:!1,roleInfo:[],newRoleVisible:!1,newRole:{name:"",grade:10},formLabelWidth:"120px",newRoleRules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:10,message:"长度在 2 到 10 个字符",trigger:"blur"}],grade:[{required:!0,type:"number",message:"级别必须为数字值"}]},newRoleButton:!1,PermissionVisible:!1,permissionInfo:[],defaultProps:{children:"children",label:"label"},expland:!1,getPermission:[],currentRole:{name:""},editPermissionButton:!1,loading2:!1,baseInfoRole:"",BaseInfoVisible:!1,baseInfoEdit:!1,roleBaseInfo:{role_id:"",name:"",grade:"",index:""}}},methods:{openNewRoleForm:function(){this.newRole={name:"",grade:10},this.newRoleVisible=!0},refresh:function(){Object.assign(this.$data,this.$options.data()),this.init()},init:function(){this.loading1=!0,this.$http.get("/role",{}).then(function(e){if(e.body.result){this.roleInfo=e.body.msg;for(var t=0;t<e.body._function.length;t++)this.permissionInfo.push(e.body._function[t]);this.$message({title:"成功",message:"获取信息成功",type:"success"})}else this.$message.error({title:"失败",message:e.body.msg});this.loading1=!1}).catch(function(e){if(422==e.status){for(var t in e.body){var s=e.body[t];this.$message.error(s[0])}}else this.$message.error("错误：状态码"+e.status);this.loading1=!1})},addRole:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return t.$message.error("未通过校验规则"),!1;t.newRoleButton=!0,t.$message.info({title:"消息",message:"正在创建新角色"}),t.$http.post("/admin/user/newRole",{newRole:t.newRole}).then(function(e){if(e.body.result){this.$message({title:"成功",message:"新建角色成功",type:"success"}),this.newRoleVisible=!1;var t=e.body.newRole,s={grade:t.grade,role_id:t.id,ifDefault:t.ifDefault,num:0,name:t.name};this.roleInfo.push(s)}else this.$message.error({title:"失败",message:e.body.msg});this.newRoleButton=!1}).catch(function(e){if(422==e.status){for(var t in e.body){var s=e.body[t];this.$message.error(s[0])}}else this.$message.error("错误：状态码"+e.status);this.newRoleButton=!1})})},setKey:function(){this.$refs.tree.setCheckedKeys(this.getPermission)},handlePermission:function(e,t){this.PermissionVisible=!0,this.currentRole=t,this.loading2=!0,this.$http.get("/admin/user/editRolePermission",{params:{role_id:t.role_id}}).then(function(e){e.body.result?(this.getPermission=e.body.permissionId,this.setKey(this.getPermission)):this.$message.error({title:"失败",message:e.body.msg}),this.loading2=!1})},open:function(){},editPermission:function(){this.editPermissionButton=!0,this.$http.post("/admin/user/editRolePermission",{permissionArr:this.$refs.tree.getCheckedKeys(),role_id:this.currentRole.role_id}).then(function(e){e.body.result?(this.$message({title:"成功",message:"修改角色权限成功",type:"success"}),this.PermissionVisible=!1):this.$message.error({title:"失败",message:e.body.msg}),this.editPermissionButton=!1}).catch(function(e){if(422==e.status){for(var t in e.body){var s=e.body[t];this.$message.error(s[0])}}else this.$message.error("错误：状态码"+e.status);this.editPermissionButton=!1})},handleEdit:function(e,t){this.baseInfoRole=t,this.roleBaseInfo.role_id=t.role_id,this.roleBaseInfo.name=t.name,this.roleBaseInfo.grade=t.grade,this.roleBaseInfo.index=e,this.BaseInfoVisible=!0,this.BaseInfoVisible=!0},editConfirm:function(e){var t=this;this.$refs.roleBaseInfo.validate(function(e){if(!e)return void t.$message.error("未通过校验规则");t.baseInfoEdit=!0,t.$http.post("/admin/user/editRoleBaseInfo",{roleBaseInfo:t.roleBaseInfo}).then(function(e){e.body.result?(this.$message({title:"成功",message:"修改角色信息成功",type:"success"}),this.roleInfo[this.roleBaseInfo.index].name=this.roleBaseInfo.name,this.roleInfo[this.roleBaseInfo.index].grade=this.roleBaseInfo.grade):this.$message.error({title:"失败",message:e.body.msg}),this.baseInfoEdit=!1,this.BaseInfoVisible=!1}).catch(function(e){if(422==e.status){for(var t in e.body){var s=e.body[t];this.$message.error(s[0])}}else this.$message.error("错误：状态码"+e.status);this.baseInfoEdit=!1})})},handleDelete:function(e,t){var s=this;return 1==t.ifDefault?void this.$message.error("无法删除默认角色"):t.num>0?void this.$message.error("请先删除该角色下所有用户"):void this.$confirm("此操作将永久删除该角色,是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){s.$http.post("/admin/user/deleteRole",{role_id:t.role_id}).then(function(t){t.body.result?(this.roleInfo.splice(e,1),this.$message({type:"success",message:"删除成功!"})):this.$message.error({title:"失败",message:t.body.msg})}).catch(function(e){if(422==e.status){for(var t in e.body){var s=e.body[t];this.$message.error(s[0])}}else this.$message.error("错误：状态码"+e.status)})}).catch(function(){s.$message({type:"info",message:"已取消删除"})})}}}},269:function(e,t,s){t=e.exports=s(7)(),t.push([e.i,".grayRow{padding:10px;background:#f2f2f2;margin:10px 0}",""])},525:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading1,expression:"loading1"}],attrs:{"element-loading-text":"加载中"}},[s("div",{staticClass:"grayRow"},[e.power.indexOf("addRole")>0?s("el-button",{attrs:{type:"primary",size:"small",icon:"plus"},on:{click:e.openNewRoleForm}},[e._v("新增角色")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small",icon:"loading"},on:{click:function(t){e.refresh()}}},[e._v("刷新")])],1),e._v(" "),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.roleInfo,stripe:""}},[s("el-table-column",{attrs:{prop:"grade",label:"角色级别",width:"250"}}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"角色名",width:"250"}}),e._v(" "),s("el-table-column",{attrs:{prop:"num",label:"人数",width:"250"}}),e._v(" "),s("el-table-column",{attrs:{label:"默认角色",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(1==t.row.ifDefault?"是":"否")+"\n            ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.power.indexOf("grantPower")>0?s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(s){e.handlePermission(t.$index,t.row)}}},[e._v("权限")]):e._e(),e._v(" "),e.power.indexOf("editRole")>0?s("el-button",{attrs:{size:"small"},on:{click:function(s){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),e.power.indexOf("deleteRole")>0?s("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(s){e.handleDelete(t.$index,t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),s("el-dialog",{attrs:{title:"新增角色",visible:e.newRoleVisible},on:{"update:visible":function(t){e.newRoleVisible=t}}},[s("el-form",{ref:"newRole",attrs:{model:e.newRole,rules:e.newRoleRules}},[s("el-row",[s("el-col",{attrs:{span:14}},[s("el-form-item",{attrs:{label:"角色名称","label-width":e.formLabelWidth,prop:"name"}},[s("el-input",{attrs:{"auto-complete":"off"},model:{value:e.newRole.name,callback:function(t){e.newRole.name=t},expression:"newRole.name"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:14}},[s("el-form-item",{attrs:{label:"角色级别","label-width":e.formLabelWidth,prop:"grade"}},[s("el-input-number",{attrs:{min:1,max:10},model:{value:e.newRole.grade,callback:function(t){e.newRole.grade=t},expression:"newRole.grade"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:14}},[s("el-form-item",{attrs:{label:"","label-width":e.formLabelWidth}},[s("span",{staticStyle:{color:"red"}},[e._v("Tip：新增角色的权限将会参考同级别角色")])])],1)],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",slot:"footer"},[s("el-button",{on:{click:function(t){e.newRoleVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.newRoleButton},on:{click:function(t){e.addRole("newRole")}}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading2,expression:"loading2"}],attrs:{title:e.currentRole.name+"权限",visible:e.PermissionVisible},on:{"update:visible":function(t){e.PermissionVisible=t},open:function(t){e.open()}}},[s("el-tree",{ref:"tree",attrs:{data:e.permissionInfo,"show-checkbox":"","check-strictly":"","node-key":"id","default-expand-all":e.expland,indent:50,props:e.defaultProps}}),e._v(" "),s("div",{staticClass:"dialog-footer",slot:"footer"},[s("el-button",{on:{click:function(t){e.PermissionVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.editPermissionButton},on:{click:function(t){e.editPermission()}}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.baseInfoRole.name+"信息",visible:e.BaseInfoVisible},on:{"update:visible":function(t){e.BaseInfoVisible=t}}},[s("el-form",{ref:"roleBaseInfo",attrs:{model:e.roleBaseInfo,rules:e.newRoleRules}},[s("el-row",[s("el-col",{attrs:{span:14}},[s("el-form-item",{attrs:{label:"角色名称","label-width":e.formLabelWidth,prop:"name"}},[s("el-input",{attrs:{"auto-complete":"off"},model:{value:e.roleBaseInfo.name,callback:function(t){e.roleBaseInfo.name=t},expression:"roleBaseInfo.name"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:14}},[s("el-form-item",{attrs:{label:"角色级别","label-width":e.formLabelWidth,prop:"grade"}},[s("el-input-number",{attrs:{min:1,max:10},model:{value:e.roleBaseInfo.grade,callback:function(t){e.roleBaseInfo.grade=t},expression:"roleBaseInfo.grade"}})],1)],1)],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",slot:"footer"},[s("el-button",{on:{click:function(t){e.BaseInfoVisible=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.baseInfoEdit},on:{click:e.editConfirm}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]}},537:function(e,t,s){var o=s(269);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);s(28)("1ce58c95",o,!0)}});