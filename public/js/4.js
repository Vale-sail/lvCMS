webpackJsonp([4],{100:function(e,t,i){i(541);var o=i(27)(i(262),i(529),null,null);e.exports=o.exports},262:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={props:["power"],mounted:function(){this.init()},data:function(){return{loading1:!1,site:{name:"",email:"",contacts:"",phone:"",qq:"",keyWord:"",openRegister:"",defaultRole:"",ICB:"",discription:""},pic:{logo:"",icon:""},roleOption:[],rules:{name:[{required:!0,message:"请输入站点名称",trigger:"blur"},{min:2,max:10,message:"长度在 2 到 10 个字符",trigger:"blur"}]},picChange:{logoChange:0,iconChange:0}}},methods:{init:function(){this.loading1=!0,this.$http.get("/siteSetting",{}).then(function(e){if(e.body.result){for(var t=e.body.roleOption,i=0;i<t.length;i++){var o=[];o.value=t[i].id,o.label=t[i].name,this.roleOption.push(o)}var a=e.body.site;this.site.name=a.name,this.pic.logo=a.logo,this.pic.icon=a.icon,this.site.email=a.email,this.site.contacts=a.contacts,this.site.phone=a.phone,this.site.qq=a.qq,this.site.keyWord=a.keyWord,this.site.openRegister=1==a.openRegister,this.site.defaultRole=a.defaultRole,this.site.ICB=a.ICB,this.site.discription=a.discription,this.$message({title:"成功",message:"获取信息成功",type:"success"})}else this.$message.error({title:"失败",message:e.body.msg});this.loading1=!1})},reset:function(){this.site={name:"",email:"",contacts:"",phone:"",qq:"",keyWord:"",openRegister:"",defaultRole:"",ICB:"",discription:""},this.roleOption=[],this.picChange={logoChange:0,iconChange:0},this.init()},logoChange:function(e){var t=$("input[name='logo']").get(0),i=t.files[0].size;if(!/image\/\w+/.test(t.files[0].type))return void this.$message.error("只能上传图片");if(i>2097152)return void this.$message.error("图片最大为2M");var o=new FileReader;o.readAsDataURL(t.files[0]);var a=this;o.onload=function(e){a.pic.logo=e.target.result},this.picChange.logoChange=1},iconChange:function(e){var t=$("input[name='icon']").get(0),i=t.files[0].size;if(!/image\/\w+/.test(t.files[0].type))return void this.$message.error("只能上传图片");if(i>2097152)return void this.$message.error("图片最大为2M");var o=new FileReader;o.readAsDataURL(t.files[0]);var a=this;o.onload=function(e){a.pic.icon=e.target.result},this.picChange.iconChange=1},onSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return t.$message.error("信息未通过校验，请重新核查"),!1;t.loading1=!0,t.$message.info({title:"消息",message:"正在更新站点配置"}),t.$http.post("/admin/site/set",{site:t.site,icon:t.picChange.iconChange?t.pic.icon:"",logo:t.picChange.logoChange?t.pic.logo:""}).then(function(e){e.body.result?this.$message({title:"成功",message:"站点配置更新成功",type:"success"}):this.$message.error({title:"失败",message:e.body.msg}),this.loading1=!1}).catch(function(e){if(422==e.status){for(var t in e.body){var i=e.body[t];this.$message.error(i[0])}}else this.$message.error("错误：状态码"+e.status)})})}}}},273:function(e,t,i){t=e.exports=i(7)(),t.push([e.i,".avatar-uploader-icon,.avatar-uploader-logo{font-size:28px;color:#8c939d;line-height:100px;text-align:center}.icon,.logo{height:100px;display:block}.mainLeft,.mainRight{padding:0 50px}hr{border:0;border-top:1px dashed #d3d3d3;padding:10px}.avatar-uploader .el-upload{border:1px dashed #d9d9d9;border-radius:6px;cursor:pointer;position:relative;overflow:hidden}.avatar-uploader .el-upload:hover{border-color:#20a0ff}.avatar-uploader-icon{width:100px;height:100px}.avatar-uploader-logo{width:400px;height:100px}.logoSelf{width:100%}.icon{width:100px}.logo{width:100%}",""])},529:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading1,expression:"loading1"}],attrs:{"element-loading-text":"加载中"}},[i("el-row",[i("el-form",{ref:"site",attrs:{model:e.site,rules:e.rules,id:"siteForm","label-width":"120px"}},[i("el-col",{attrs:{span:12}},[i("div",{staticClass:"mainLeft"},[i("el-form-item",{attrs:{label:"站点标题",prop:"name"}},[i("el-input",{model:{value:e.site.name,callback:function(t){e.site.name=t},expression:"site.name"}})],1),e._v(" "),i("hr"),e._v(" "),i("el-form-item",{attrs:{label:"站点Logo"}},[i("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/qq","show-file-list":!1,"auto-upload":!1,"with-credentials":!0,name:"logo",accept:"image/jpg,image/png","on-change":e.logoChange}},[e.pic.logo?i("img",{staticClass:"logo",attrs:{src:e.pic.logo}}):i("i",{staticClass:"el-icon-plus avatar-uploader-logo"})])],1),e._v(" "),i("hr"),e._v(" "),i("el-form-item",{attrs:{label:"站点icon"}},[i("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/qq","show-file-list":!1,"auto-upload":!1,"with-credentials":!0,name:"icon",accept:"image/jpg,image/png,image/x-icon","on-change":e.iconChange}},[e.pic.icon?i("img",{staticClass:"icon",attrs:{src:e.pic.icon}}):i("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),i("hr"),e._v(" "),i("el-form-item",{attrs:{label:"网站邮箱"}},[i("el-input",{model:{value:e.site.email,callback:function(t){e.site.email=t},expression:"site.email"}})],1),e._v(" "),i("hr"),e._v(" "),i("el-form-item",{attrs:{label:"联系人"}},[i("el-input",{model:{value:e.site.contacts,callback:function(t){e.site.contacts=t},expression:"site.contacts"}})],1),e._v(" "),i("hr"),e._v(" "),i("el-form-item",{attrs:{label:"联系电话"}},[i("el-input",{model:{value:e.site.phone,callback:function(t){e.site.phone=t},expression:"site.phone"}})],1),e._v(" "),i("hr"),e._v(" "),i("el-form-item",{attrs:{label:"联系QQ"}},[i("el-input",{model:{value:e.site.qq,callback:function(t){e.site.qq=t},expression:"site.qq"}})],1),e._v(" "),i("hr"),e._v(" "),i("el-form-item",{attrs:{label:"站点关键字"}},[i("el-input",{model:{value:e.site.keyWord,callback:function(t){e.site.keyWord=t},expression:"site.keyWord"}})],1)],1)]),e._v(" "),i("el-col",{attrs:{span:12}},[i("div",{staticClass:"mainRight"},[i("el-form-item",{attrs:{label:"开放注册",required:""}},[i("el-switch",{attrs:{"on-text":"是","off-text":"否"},model:{value:e.site.openRegister,callback:function(t){e.site.openRegister=t},expression:"site.openRegister"}})],1),e._v(" "),i("hr"),e._v(" "),i("el-form-item",{attrs:{label:"新用户默认角色",required:""}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.site.defaultRole,callback:function(t){e.site.defaultRole=t},expression:"site.defaultRole"}},e._l(e.roleOption,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),i("hr"),e._v(" "),i("el-form-item",{attrs:{label:"ICB备案号"}},[i("el-input",{model:{value:e.site.ICB,callback:function(t){e.site.ICB=t},expression:"site.ICB"}})],1),e._v(" "),i("hr"),e._v(" "),i("el-form-item",{attrs:{label:"站点描述"}},[i("el-input",{attrs:{type:"textarea",autosize:""},model:{value:e.site.discription,callback:function(t){e.site.discription=t},expression:"site.discription"}})],1),e._v(" "),i("el-form-item",[e.power.indexOf("editSiteSetting")>0?i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.onSubmit("site")}}},[e._v("保存配置")]):e._e(),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.reset}},[e._v("重置配置")])],1)],1)])],1)],1)],1)},staticRenderFns:[]}},541:function(e,t,i){var o=i(273);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);i(28)("1d018f74",o,!0)}});